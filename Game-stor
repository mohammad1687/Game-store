<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e1e1e"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://assets.codepen.io/32887/gs-icon-192.png">
    <title>گیم استور | نسخه نهایی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-size-normal: 16px;
            --font-size-small: 14px;
            --font-size-large: 18px;
        }
        /* THEME DEFINITIONS */
        html.light {
            --bg-primary: #f8f9fa; --bg-secondary: #ffffff; --bg-tertiary: #e9ecef;
            --text-primary: #212529; --text-secondary: #6c757d; --border-color: #dee2e6;
            --accent-color: #4f46e5; --accent-color-hover: #4338ca; --star-color: #f59e0b;
        }
        html.dark {
            --bg-primary: #121212; --bg-secondary: #1e1e1e; --bg-tertiary: #2c2c2c;
            --text-primary: #e0e0e0; --text-secondary: #a0a0a0; --border-color: #3a3a3a;
            --accent-color: #6366f1; --accent-color-hover: #4f46e5; --star-color: #facc15;
        }
        html.midnight {
            --bg-primary: #191e3a; --bg-secondary: #22284b; --bg-tertiary: #2f365f;
            --text-primary: #e0e6f0; --text-secondary: #a0aed0; --border-color: #4a5568;
            --accent-color: #818cf8; --accent-color-hover: #6772e5; --star-color: #fbb040;
        }
        html.dracula {
            --bg-primary: #282a36; --bg-secondary: #383a59; --bg-tertiary: #44475a;
            --text-primary: #f8f8f2; --text-secondary: #bd93f9; --border-color: #6272a4;
            --accent-color: #ff79c6; --accent-color-hover: #ff55b8; --star-color: #f1fa8c;
        }
        html.sepia {
            --bg-primary: #f4ecd8; --bg-secondary: #fbf5e9; --bg-tertiary: #e6dbbf;
            --text-primary: #433422; --text-secondary: #7a6a55; --border-color: #d3c4a5;
            --accent-color: #8c5a2b; --accent-color-hover: #7b4d21; --star-color: #d97706;
        }
        html.forest {
            --bg-primary: #1a2a24; --bg-secondary: #243831; --bg-tertiary: #304d41;
            --text-primary: #d5e5dd; --text-secondary: #97b3a6; --border-color: #4a6b5d;
            --accent-color: #34d399; --accent-color-hover: #10b981; --star-color: #fcd34d;
        }

        /* FONT SIZE CONTROL */
        html { font-size: var(--font-size-normal); }
        html.font-size-small { font-size: var(--font-size-small); }
        html.font-size-large { font-size: var(--font-size-large); }
        
        /* SPLASH SCREEN */
        #splash-screen {
            position: fixed; inset: 0; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background-color: var(--bg-primary); color: var(--text-primary);
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        #splash-screen.hidden { opacity: 0; visibility: hidden; }
        .splash-logo { font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem; }
        .splash-subtitle { font-size: 1.1rem; color: var(--text-secondary); }

        /* General Styles */
        html.no-animations * { transition: none !important; animation: none !important; }
        body { font-family: 'Vazirmatn', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
        .bg-primary { background-color: var(--bg-primary); } .bg-secondary { background-color: var(--bg-secondary); } .bg-tertiary { background-color: var(--bg-tertiary); }
        .text-primary { color: var(--text-primary); } .text-secondary { color: var(--text-secondary); } .border-color { border-color: var(--border-color); }
        .accent-bg { background-color: var(--accent-color); } .accent-bg-hover:hover { background-color: var(--accent-color-hover); }
        .accent-text { color: var(--accent-color); }
        .ring-color { --tw-ring-color: var(--border-color); }
        .focus-ring-accent:focus { --tw-ring-color: var(--accent-color); }
        input.bg-tertiary::placeholder, textarea.bg-tertiary::placeholder { color: var(--text-secondary); opacity: 0.7; }
        .scroll-smooth { scroll-behavior: smooth; } .scrollbar-hide::-webkit-scrollbar { display: none; } .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        #sidebar.open { transform: translateX(0); }
        .loader { border: 5px solid var(--bg-tertiary); border-top: 5px solid var(--accent-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .toast { background-color: #2c2c2c; color: white; padding: 12px 20px; border-radius: 8px; font-size: 0.875rem; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .star-rating svg { color: var(--star-color); }
        .faq-item details > summary { list-style: none; }
        .faq-item details > summary::-webkit-details-marker { display: none; }
        .faq-item details > summary { cursor: pointer; display: flex; justify-content: space-between; align-items: center;}
        .faq-item details > summary::after { content: '+'; font-size: 1.5rem; transition: transform 0.2s; }
        .faq-item details[open] > summary::after { transform: rotate(45deg); }
        .faq-item details[open] > summary { color: var(--accent-color); }
    </style>
</head>
<body class="bg-primary">

    <div id="splash-screen">
        <div class="splash-logo" data-translate="app_title">گیم استور</div>
        <div class="splash-subtitle">محمد امین حاجیلو</div>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-40 hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="fixed top-0 right-0 h-full w-72 md:w-80 bg-secondary shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out p-4 flex flex-col border-l border-color">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-primary" data-translate="menu">منو</h2>
            <button id="close-sidebar-btn" class="p-2 rounded-full hover:bg-tertiary"><svg class="w-6 h-6 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
        </div>
        <nav class="flex flex-col gap-1 flex-grow">
            <a href="#" id="sidebar-home-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg><span data-translate="home_page">صفحه اصلی</span></a>
            <a href="#" id="sidebar-profile-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg><span data-translate="profile">پروفایل</span></a>
            <a href="#" id="sidebar-my-games-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg><span data-translate="my_games">بازی های من</span></a>
            <a href="#" id="sidebar-app-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg><span data-translate="site_app">نصب برنامه</span></a>
            <div class="flex-grow"></div>
            <hr class="border-t border-color my-2">
            <a href="#" id="sidebar-settings-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span data-translate="settings">تنظیمات</span></a>
            <a href="#" id="sidebar-support-btn" class="sidebar-link flex items-center gap-4 p-3 rounded-lg hover:bg-tertiary text-primary"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 21.75l-.648-1.188a2.25 2.25 0 01-1.423-1.423L13.5 18.75l1.188-.648a2.25 2.25 0 011.423-1.423L16.25 15l.648 1.188a2.25 2.25 0 011.423 1.423L18.5 18.75l-1.188.648a2.25 2.25 0 01-1.423 1.423z" /></svg><span data-translate="support">پشتیبانی</span></a>
        </nav>
    </aside>

    <div id="app-container" class="opacity-0 transition-opacity duration-500">
        <div id="home-page">
            <header class="bg-secondary shadow-md sticky top-0 z-30 p-4">
                <div class="container mx-auto flex justify-between items-center">
                    <div class="flex items-center gap-4 flex-1"><h1 class="text-2xl font-bold text-primary" data-translate="app_title">گیم استور</h1><div class="relative w-full max-w-lg hidden md:block"><input type="text" id="search-input" data-translate-placeholder="search_placeholder" placeholder="جستجوی بازی..." class="w-full bg-tertiary border border-color rounded-lg py-2 px-4 text-primary focus:outline-none focus:ring-2 focus-ring-accent ring-color"><svg class="w-5 h-5 text-secondary absolute left-3 top-1/2 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div>
                    <button id="sidebar-toggle-btn" class="p-2 rounded-full hover:bg-tertiary focus:outline-none"><svg class="w-6 h-6 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
                </div>
            </header>
            <main class="container mx-auto p-4 md:p-6">
                <div class="relative w-full mb-6 md:hidden"><input type="text" id="search-input-mobile" data-translate-placeholder="search_placeholder" placeholder="جستجوی بازی..." class="w-full bg-tertiary border border-color rounded-lg py-2 px-4 text-primary focus:outline-none focus:ring-2 focus-ring-accent ring-color"><svg class="w-5 h-5 text-secondary absolute left-3 top-1/2 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div>
                <section class="mb-8"><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="featured_games">بازی‌های منتخب</h2><div class="relative"><div id="featured-carousel" class="flex overflow-x-auto snap-x snap-mandatory scroll-smooth scrollbar-hide -mx-2"></div><button id="prev-btn" class="absolute left-0 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full z-10 hidden md:block"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><button id="next-btn" class="absolute right-0 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full z-10 hidden md:block"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div></section>
                <section id="filter-sort-section" class="bg-secondary p-4 rounded-lg shadow-md mb-8"><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div><label for="filter-category" class="block text-sm font-medium text-secondary" data-translate="filter_category">دسته‌بندی</label><select id="filter-category" class="mt-1 block w-full bg-tertiary border-color rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus-ring-accent sm:text-sm text-primary"><option value="all" data-translate="all">همه</option><option value="pc" data-translate="pc_games">کامپیوتر</option><option value="mobile" data-translate="mobile_games">موبایل</option></select></div><div><label for="filter-status" class="block text-sm font-medium text-secondary" data-translate="filter_status">وضعیت</label><select id="filter-status" class="mt-1 block w-full bg-tertiary border-color rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus-ring-accent sm:text-sm text-primary"><option value="all" data-translate="all">همه</option><option value="true" data-translate="online">آنلاین</option><option value="false" data-translate="offline">آفلاین</option></select></div><div class="col-span-2 md:col-span-2"><label for="sort-by" class="block text-sm font-medium text-secondary" data-translate="sort_by">مرتب‌سازی بر اساس</label><select id="sort-by" class="mt-1 block w-full bg-tertiary border-color rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus-ring-accent sm:text-sm text-primary"><option value="default" data-translate="sort_default">پیش‌فرض</option><option value="title-asc" data-translate="sort_title_asc">نام (صعودی)</option><option value="title-desc" data-translate="sort_title_desc">نام (نزولی)</option><option value="rating-desc" data-translate="sort_rating_desc">امتیاز (بیشترین)</option><option value="date-desc" data-translate="sort_date_desc">تاریخ انتشار (جدیدترین)</option></select></div></div></section>
                <section id="all-games-section"><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="all_games">همه بازی‌ها</h2><div id="games-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div></section>
                <div id="loader-container" class="text-center py-10 hidden"><div class="loader mx-auto"></div></div>
                <div id="no-results" class="text-center py-10 text-secondary hidden"><h3 class="text-xl" data-translate="no_results">موردی یافت نشد.</h3></div>
            </main>
        </div>
        
        <div id="game-detail-page" class="hidden"></div>
        <div id="download-page" class="hidden"></div>
        <div id="my-games-page" class="hidden"></div>
        <div id="support-page" class="hidden"></div>

        <div id="profile-page" class="hidden">
             <div class="container mx-auto p-4 md:p-8 max-w-5xl">
                <button class="back-btn mb-4 text-primary hover:accent-text" data-page="home">→ <span data-translate="back_to_home"></span></button>
                <div id="auth-section" class="bg-secondary p-8 rounded-lg shadow-lg hidden max-w-md mx-auto"><h2 class="text-2xl font-bold mb-6 text-center text-primary" data-translate="signup">ثبت نام یا ورود</h2><p class="text-center text-secondary mb-4" data-translate="login_helper_text"></p><form id="signup-form"><div class="mb-4"><label for="username" class="block mb-2 text-sm font-medium text-secondary" data-translate="username">نام کاربری (ID)</label><input type="text" id="username" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" required></div><div class="mb-6"><label for="password" class="block mb-2 text-sm font-medium text-secondary" data-translate="password">رمز عبور</label><input type="password" id="password" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" required></div><button type="submit" class="w-full accent-bg text-white font-bold py-2 px-4 rounded-lg accent-bg-hover" data-translate="enter">ورود</button></form></div>
                <div id="user-profile-section" class="hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-8">
                            <div class="bg-secondary p-6 rounded-lg shadow-lg flex flex-col items-center text-center"><div class="relative"><img id="profile-pic-display" src="https://placehold.co/128x128/2c2c2c/a0a0a0?text=User" alt="Profile Picture" class="w-32 h-32 rounded-full mb-4 border-4 border-color object-cover"><button id="change-pic-btn" class="absolute bottom-4 -right-1 accent-bg p-2 rounded-full text-white accent-bg-hover focus:outline-none ring-2 ring-secondary"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z"></path></svg></button></div><input type="file" id="profile-pic-upload" class="hidden" accept="image/*"><h2 id="profile-display-name" class="text-2xl font-bold text-primary mt-2"></h2><p id="profile-username" class="text-secondary"></p><span class="mt-4 bg-green-200 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300" data-translate="level_gamer">گیمر</span><p class="text-xs text-secondary mt-4"><span data-translate="member_since">عضو از:</span> <span id="member-since"></span></p><button id="logout-btn" class="w-full mt-6 bg-red-600/80 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600" data-translate="logout">خروج از حساب</button></div>
                             <div class="bg-secondary p-6 rounded-lg shadow-lg"><h3 class="text-xl font-bold text-primary mb-4" data-translate="profile_stats">آمار پروفایل</h3><ul id="profile-stats-list" class="space-y-3 text-sm"></ul></div>
                        </div>
                        <div class="lg:col-span-2 bg-secondary p-6 rounded-lg shadow-lg"><h3 class="text-xl font-bold text-primary mb-6" data-translate="edit_profile">ویرایش پروفایل</h3><form id="profile-form"><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="form-display-name" class="block mb-2 text-sm font-medium text-secondary" data-translate="display_name">نام نمایشی</label><input type="text" id="form-display-name" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" placeholder="نام خود را وارد کنید"></div><div><label for="form-email" class="block mb-2 text-sm font-medium text-secondary" data-translate="email">ایمیل</label><input type="email" id="form-email" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" placeholder="email@example.com"></div></div><div class="mt-4"><label for="form-bio" class="block mb-2 text-sm font-medium text-secondary" data-translate="bio">بیوگرافی</label><textarea id="form-bio" rows="3" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" placeholder="کمی درباره خودتان بنویسید..."></textarea></div><div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="form-social-twitter" class="block mb-2 text-sm font-medium text-secondary" data-translate="social_twitter">توییتر</label><input type="text" id="form-social-twitter" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" placeholder="@username"></div><div><label for="form-social-steam" class="block mb-2 text-sm font-medium text-secondary" data-translate="social_steam">استیم</label><input type="text" id="form-social-steam" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary ring-color focus:ring-2 focus-ring-accent" placeholder="Steam Profile URL"></div></div><button type="submit" class="mt-6 w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700" data-translate="save_changes">ذخیره تغییرات</button></form>
                        <hr class="border-t border-color my-8"><h3 class="text-xl font-bold text-primary mb-4" data-translate="activity_feed">فید فعالیت</h3><div id="activity-feed-container" class="space-y-4 max-h-60 overflow-y-auto pr-2"></div></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings-page" class="hidden">
            <div class="container mx-auto p-4 md:p-8 max-w-3xl">
                <button class="back-btn mb-4 text-primary hover:accent-text" data-page="home">→ <span data-translate="back_to_home"></span></button>
                <div class="space-y-8">
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="appearance">ظاهر</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <label for="theme-select" class="text-primary" data-translate="theme">تم برنامه</label>
                                <select id="theme-select" class="bg-tertiary border border-color text-primary text-sm rounded-lg focus:ring-2 focus-ring-accent block p-2.5">
                                    <option value="light" data-translate="theme_light">روشن</option>
                                    <option value="dark" data-translate="theme_dark">تاریک</option>
                                    <option value="midnight" data-translate="theme_midnight">نیمه‌شب</option>
                                    <option value="dracula" data-translate="theme_dracula">دراکولا</option>
                                    <option value="sepia" data-translate="theme_sepia">سپیا</option>
                                    <option value="forest" data-translate="theme_forest">جنگل</option>
                                </select>
                            </div>
                            <hr class="border-t border-color/50">
                            <div class="flex items-center justify-between">
                                <label for="language-select" class="text-primary" data-translate="language">زبان</label>
                                <select id="language-select" class="bg-tertiary border border-color text-primary text-sm rounded-lg focus:ring-2 focus-ring-accent block p-2.5">
                                    <option value="fa">فارسی</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="preferences">ترجیحات</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <label for="font-size-select" class="text-primary cursor-pointer" data-translate="font_size">اندازه فونت</label>
                                <select id="font-size-select" class="bg-tertiary border border-color text-primary text-sm rounded-lg focus:ring-2 focus-ring-accent block p-2.5">
                                    <option value="small" data-translate="font_size_small">کوچک</option>
                                    <option value="normal" data-translate="font_size_normal">متوسط</option>
                                    <option value="large" data-translate="font_size_large">بزرگ</option>
                                </select>
                            </div>
                            <hr class="border-t border-color/50">
                            <div class="flex items-center justify-between">
                                <label for="pref-animations-toggle" class="text-primary cursor-pointer" data-translate="enable_animations">فعال‌سازی انیمیشن‌ها</label>
                                <input type="checkbox" id="pref-animations-toggle" class="form-checkbox h-5 w-5 accent-bg bg-tertiary border-color rounded focus:ring-2 focus-ring-accent cursor-pointer">
                            </div>
                            <hr class="border-t border-color/50">
                            <div class="flex items-center justify-between">
                                <label for="pref-notifications-toggle" class="text-primary cursor-pointer" data-translate="enable_notifications">فعال‌سازی نوتیفیکیشن‌ها</label>
                                <input type="checkbox" id="pref-notifications-toggle" class="form-checkbox h-5 w-5 accent-bg bg-tertiary border-color rounded focus:ring-2 focus-ring-accent cursor-pointer">
                            </div>
                            <hr class="border-t border-color/50">
                            <button id="reset-settings-btn" class="w-full text-left accent-text hover:bg-tertiary p-3 rounded-lg" data-translate="reset_settings">بازنشانی تنظیمات به پیش‌فرض</button>
                        </div>
                    </div>
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="data_privacy">داده و حریم خصوصی</h3>
                        <div class="space-y-4">
                            <div class="flex flex-col sm:flex-row gap-4">
                                <button id="export-data-btn" class="flex-1 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700" data-translate="export_data">خروجی گرفتن از داده‌ها</button>
                                <button id="import-data-btn" class="flex-1 bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700" data-translate="import_data">ورودی گرفتن داده‌ها</button>
                            </div>
                            <input type="file" id="import-file-input" class="hidden" accept=".json">
                            <hr class="border-t border-color/50">
                            <button id="clear-cache-btn" class="w-full text-left text-red-500 hover:bg-tertiary p-3 rounded-lg" data-translate="clear_cache">پاک کردن حافظه پنهان و بازنشانی کامل</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center hidden p-4"><div class="bg-secondary p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 border border-color"><h3 id="modal-title" class="text-xl font-bold text-primary mb-4 text-center"></h3><p id="modal-text" class="text-center text-lg text-secondary whitespace-pre-line"></p><div id="modal-buttons" class="mt-6 flex gap-4"><button id="modal-confirm-btn" class="flex-1 bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 hidden" data-translate="confirm">تایید</button><button id="modal-cancel-btn" class="flex-1 bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600" data-translate="cancel">لغو</button></div></div></div>
    <div id="toast-container"></div>
    
    <script>
        // PWA Scripts
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js').then(r => console.log('SW registered')).catch(e => console.log('SW reg failed', e)); }); }
        let deferredPrompt;
        const installButton = document.getElementById('sidebar-app-btn');
        if(installButton) installButton.style.display = 'none';
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; if(installButton) installButton.style.display = 'flex'; if(installButton) installButton.onclick = (ev) => { installButton.style.display = 'none'; deferredPrompt.prompt(); deferredPrompt.userChoice.then((c) => { deferredPrompt = null; }); }; });
    </script>
    
    <script>
    // GAME STORE SCRIPT - V7.0 - THE SECURE EDITION
    (function() {
        // ===== DATABASE (WITH OFFICIAL STORE LINKS) =====
        const games = [
             { id: 1, title: 'Cyberpunk 2077', fa_title: 'سایبرپانک ۲۰۷۷', category: 'pc', isOnline: true, featured: true, rating: 4.5, release_date: '2020-12-10', developer: 'CD PROJEKT RED', publisher: 'CD PROJEKT RED', genres: ['RPG', 'Open World'], fa_genres: ['نقش‌آفرینی', 'جهان‌باز'], image: 'https://cdn.gracza.pl/i_gp/h/22/351659140.jpg', trailer_url: 'https://www.youtube.com/embed/E3Huy2cdeuc5',
              fa_description: 'در نقش «وی»، یک مزدور شهری، در کلان‌شهر عظیم و غرق در تکنولوژی «نایت سیتی» ماجراجویی کنید. این بازی نقش‌آفرینی اکشن، شما را در داستانی عمیق و چندلایه غرق می‌کند که در آن هر انتخاب شما بر سرنوشت شخصیت‌ها و شهر تأثیر می‌گذارد.',
              fa_gameplay: 'گیم‌پلی بازی ترکیبی از عناصر شوتر اول شخص، هک کردن، و مبارزات تن به تن است. با استفاده از ایمپلنت‌های سایبرنتیک، توانایی‌های خود را ارتقا داده و سبک بازی خود را شخصی‌سازی کنید. از رانندگی در خیابان‌های نئونی تا انجام ماموریت‌های پیچیده برای شرکت‌های بزرگ، آزادی عمل گسترده‌ای برای تبدیل شدن به افسانه نایت سیتی در اختیار دارید.',
              fa_system_req: { minimum: 'Win 10 64-Bit, Core i7-6700, 12GB RAM, GTX 1060 6GB, 70GB SSD', recommended: 'Win 10 64-Bit, Core i7-12700, 16GB RAM, RTX 2060 SUPER, 70GB SSD' },
              download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1091500/Cyberpunk_2077/' }, { part: 'خرید از Epic Games', url: 'https://www.epicgames.com/store/en-US/p/cyberpunk-2077' }]
            },
            { id: 2, title: 'The Witcher 3: Wild Hunt', fa_title: 'ویچر ۳: وایلد هانت', category: 'pc', isOnline: false, featured: true, rating: 4.9, release_date: '2015-05-19', developer: 'CD PROJEKT RED', publisher: 'CD PROJEKT RED', genres: ['RPG', 'Fantasy'], fa_genres: ['نقش‌آفرینی', 'فانتزی'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/292030/header.jpg?t=1701352433', trailer_url: 'https://www.youtube.com/embed/E3Huy2cdeuc6',
              fa_description: 'به عنوان گرالت از ریویا، یک شکارچی هیولای حرفه‌ای، در دنیایی وسیع و جنگ‌زده به دنبال «سیری»، فرزند پیشگویی، بگردید. ویچر ۳ به عنوان یکی از برترین بازی‌های تاریخ شناخته می‌شود و با داستان‌سرایی فوق‌العاده، شخصیت‌های به‌یادماندنی، و دنیایی زنده و پر از ماموریت‌های جانبی جذاب، تجربه‌ای بی‌نظیر را برای شما رقم می‌زند.',
              fa_gameplay: 'گیم‌پلی بر پایه کاوش در دنیای وسیع، مبارزات تاکتیکی با شمشیر و استفاده از جادوهای ویچری (Signs) استوار است. شما می‌توانید معجون بسازید، تجهیزات خود را ارتقا دهید و در قراردادهای شکار هیولا شرکت کنید. هر تصمیم شما در دیالوگ‌ها و ماموریت‌ها می‌تواند پایان داستان را تغییر دهد.',
              fa_system_req: { minimum: 'Win 7 64-Bit, i5-2500K, 6GB RAM, GTX 660, 35GB HDD', recommended: 'Win 10 64-Bit, i7-3770, 8GB RAM, GTX 770, 35GB HDD' },
              download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/292030/The_Witcher_3_Wild_Hunt/' }]
            },
            { id: 3, title: 'Red Dead Redemption 2', fa_title: 'رد دد ریدمپشن ۲', category: 'pc', isOnline: true, featured: false, rating: 4.8, release_date: '2019-11-05', developer: 'Rockstar Games', publisher: 'Rockstar Games', genres: ['Action', 'Western'], fa_genres: ['اکشن', 'وسترن'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1174180/header.jpg?t=1695140955', trailer_url: 'https://www.youtube.com/embed/E3Huy2cdeuc7',
              fa_description: 'در سال ۱۸۹۹، دوران غرب وحشی رو به پایان است. آرتور مورگان و گروه وندر لیند پس از یک سرقت نافرجام، مجبور به فرار می‌شوند. این بازی حماسی، با دنیایی بی‌نهایت پرجزئیات و داستانی عمیق درباره وفاداری، شرافت و بقا، شما را در قلب بی‌رحم آمریکا غرق خواهد کرد.',
              fa_gameplay: 'شما در نقش آرتور مورگان، در یک دنیای جهان‌باز بسیار واقع‌گرایانه زندگی می‌کنید. از شکار و ماهی‌گیری گرفته تا دوئل‌های مرگبار و سرقت از قطار، فعالیت‌های بی‌شماری برای انجام دادن وجود دارد. سیستم تعامل با شخصیت‌های دیگر بسیار عمیق است و هر عمل شما در این دنیای زنده، عواقبی به دنبال دارد.',
              fa_system_req: { minimum: 'Win 10, i5-2500K, 8GB RAM, GTX 770 2GB, 150GB HDD', recommended: 'Win 10, i7-4770K, 12GB RAM, GTX 1060 6GB, 150GB HDD' },
              download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1174180/Red_Dead_Redemption_2/' }]
            },
             { id: 4, title: 'Elden Ring', fa_title: 'الدن رینگ', category: 'pc', isOnline: true, featured: false, rating: 4.7, release_date: '2022-02-25', developer: 'FromSoftware', publisher: 'Bandai Namco', genres: ['RPG', 'Souls-like'], fa_genres: ['نقش‌آفرینی', 'سولز-لایک'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1245620/header.jpg?t=1703250284', trailer_url: 'https://www.youtube.com/embed/E3Huy2cdeuc8',
              fa_description: 'الدن رینگ، محصول همکاری استودیوی افسانه‌ای فرام‌سافتور و نویسنده شهیر، جرج آر. آر. مارتین، یک تجربه نقش‌آفرینی اکشن در دنیایی وسیع و مرموز است. در نقش یک "Tarnished" برخیزید و در "سرزمین‌های میانه" به کاوش بپردازید تا تکه‌های الدن رینگ را یافته و به الدن لرد تبدیل شوید.',
              fa_gameplay: 'این بازی با مبارزات چالش‌برانگیز و آزادی عمل بی‌نظیر، استاندارد جدیدی برای سبک جهان‌باز تعریف کرده است. بازیکنان می‌توانند با اسب در دنیای پهناور آن سفر کنند، سیاه‌چال‌های مخفی را کشف کنند و با باس‌های غول‌پیکر و به‌یادماندنی مبارزه کنند. تنوع سلاح‌ها، جادوها و مهارت‌ها به شما اجازه می‌دهد تا شخصیت خود را به هر شکلی که می‌خواهید بسازید.',
              fa_system_req: { minimum: 'Win 10, i5-8400, 12GB RAM, GTX 1060 3GB, 60GB HDD', recommended: 'Win 11, i7-8700K, 16GB RAM, GTX 1070 8GB, 60GB SSD' },
              download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1245620/ELDEN_RING/' }]
            },
            { id: 5, title: 'Baldur\'s Gate 3', fa_title: 'بالدرز گیت ۳', category: 'pc', isOnline: true, featured: true, rating: 4.9, release_date: '2023-08-03', developer: 'Larian Studios', publisher: 'Larian Studios', genres: ['RPG', 'Strategy'], fa_genres: ['نقش‌آفرینی', 'استراتژی'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1887720/header.jpg?t=1716492339', trailer_url: 'https://www.youtube.com/embed/E3Huy2cdeuc9',
              fa_description: 'به دنیای فراموش شده (Forgotten Realms) بازگردید. داستانی از همراهی و خیانت، بقا و فداکاری، و وسوسه‌ی قدرت مطلق. بالدرز گیت ۳ یک بازی نقش آفرینی نسل جدید است که در آن انتخاب‌های شما، داستان را شکل می‌دهند. یک انگل ذهنی در سر شما کاشته شده که قدرت‌های مرموزی به شما می‌دهد، اما بهای آن چیست؟',
              fa_gameplay: 'این بازی بر اساس قوانین Dungeons & Dragons ساخته شده و دارای مبارزات نوبتی بسیار عمیق و تاکتیکی است. شما می‌توانید گروهی از شخصیت‌های پیچیده را رهبری کنید که هرکدام داستان و اهداف خود را دارند. تعاملات شما با همراهان و دنیای بازی، مسیر داستان را به شکل غیرمنتظره‌ای تغییر می‌دهد. آزادی عمل در این بازی بی‌نظیر است و هر مشکلی را می‌توان با روش‌های خلاقانه حل کرد.',
              fa_system_req: { minimum: 'Win 10, i5-4690, 8GB RAM, GTX 970 4GB, 150GB SSD', recommended: 'Win 10, i7-8700K, 16GB RAM, RTX 2060S 8GB, 150GB SSD' },
              download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1086940/Baldurs_Gate_3/' }]
            },
            { id: 6, title: 'The Last of Us Part I', fa_title: 'آخرین بازمانده از ما: بخش ۱', category: 'pc', isOnline: false, featured: true, rating: 4.8, release_date: '2023-03-28', developer: 'Naughty Dog', publisher: 'PlayStation PC LLC', genres: ['Action', 'Story-Rich'], fa_genres: ['اکشن', 'داستان-محور'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1888930/header.jpg?t=1697649548', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs0',
                fa_description: 'داستان احساسی و شخصیت‌های فراموش‌نشدنی بازی The Last of Us را تجربه کنید، عنوانی که بیش از ۲۰۰ جایزه بهترین بازی سال را دریافت کرده است. در یک تمدن ویران شده که بازماندگان وحشی و آلودگان به قارچ در آن پرسه می‌زنند، جوئل، قهرمانی خسته، استخدام می‌شود تا الی ۱۴ ساله را از یک منطقه قرنطینه نظامی خارج کند.',
                fa_gameplay: 'گیم‌پلی ترکیبی از مبارزات خشن، مخفی‌کاری پرتنش و جستجو برای منابع کمیاب است. شما باید با استفاده از سلاح‌های دست‌ساز و یافتنی، با دشمنان انسانی و آلودگان مقابله کنید. هر گلوله و هر آیتمی ارزشمند است و تصمیم‌گیری‌های هوشمندانه برای بقا ضروری است. این نسخه کاملاً برای کامپیوتر بازسازی شده و از ویژگی‌های گرافیکی پیشرفته بهره می‌برد.',
                fa_system_req: { minimum: 'Win 10, Ryzen 5 1500X, 16GB RAM, RX 470 4GB, 100GB SSD', recommended: 'Win 10, Ryzen 5 3600X, 16GB RAM, RX 6600XT 8GB, 100GB SSD' },
                download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1888930/The_Last_of_Us_Part_I/' }]
            },
            { id: 7, title: 'Hades', fa_title: 'هیدیس', category: 'pc', isOnline: false, featured: false, rating: 4.9, release_date: '2020-09-17', developer: 'Supergiant Games', publisher: 'Supergiant Games', genres: ['Roguelike', 'Action'], fa_genres: ['روگ‌لایک', 'اکشن'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1145360/header.jpg?t=1699567406', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs1',
                fa_description: 'در نقش زگرئوس، شاهزاده نامیرای دنیای زیرین، از چنگال پدرتان، هیدیس، خدای مردگان، فرار کنید. این بازی روگ‌لایک با ترکیب اکشن سریع، داستان‌سرایی عمیق و هنر خیره‌کننده، تجربه‌ای منحصر به فرد ارائه می‌دهد.',
                fa_gameplay: 'در هر بار تلاش برای فرار، با استفاده از سلاح‌های اساطیری و قدرت‌های خدایان المپ، با دشمنان مبارزه می‌کنید. با هر بار مرگ، به خانه بازمی‌گردید اما قوی‌تر می‌شوید و می‌توانید با شخصیت‌های دنیای زیرین تعامل کرده و داستان را پیش ببرید. هر فرار، ترکیبی متفاوت از قدرت‌ها و چالش‌ها را به همراه دارد که ارزش تکرار بازی را بسیار بالا می‌برد.',
                fa_system_req: { minimum: 'Win 7, Dual Core 2.4 GHz, 4GB RAM, 1GB VRAM, 15GB HDD', recommended: 'Win 10, Quad Core 2.4 GHz, 8GB RAM, 2GB VRAM, 20GB SSD' },
                download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1145360/Hades/' }]
            },
            { id: 8, title: 'Valorant', fa_title: 'ولورانت', category: 'pc', isOnline: true, featured: true, rating: 4.4, release_date: '2020-06-02', developer: 'Riot Games', publisher: 'Riot Games', genres: ['FPS', 'Tactical'], fa_genres: ['شوتر اول شخص', 'تاکتیکال'], image: 'https://images.g2a.com/1024x768/1x1x0/valorant-points-25-eur-riot-key-europe-i10000206973010/5ec5529c7e696c42a23c3165', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs2',
              fa_description: 'ولورانت یک شوتر تاکتیکال تیمی ۵ به ۵ از استودیوی رایت گیمز است. در این بازی، خلاقیت به اندازه مهارت تیراندازی اهمیت دارد. این بازی به سرعت به یکی از محبوب‌ترین عناوین ورزش‌های الکترونیک تبدیل شد.',
              fa_gameplay: 'با انتخاب "ایجنت‌ها" که هرکدام قابلیت‌های منحصربه‌فردی دارند، در راندهای مختلف به رقابت بپردازید. هر تیم باید در نوبت حمله، بمب را کار بگذارد و در نوبت دفاع، از این کار جلوگیری کند. استفاده هوشمندانه از قابلیت‌ها، کنترل نقشه و تیراندازی دقیق، کلید پیروزی است.',
              fa_system_req: { minimum: 'Win 10, Core 2 Duo E8400, 4GB RAM, Intel HD 4000, 30GB HDD', recommended: 'Win 10, i3-4150, 4GB RAM, GeForce GT 730, 30GB HDD' },
              download_links: [{ part: 'دریافت از سایت رسمی', url: 'https://playvalorant.com/' }]
            },
            { id: 12, title: 'Dave the Diver', fa_title: 'دیو غواص', category: 'pc', isOnline: false, featured: false, rating: 4.9, release_date: '2023-06-28', developer: 'MINTROCKET', publisher: 'MINTROCKET', genres: ['Adventure', 'Simulation'], fa_genres: ['ماجراجویی', 'شبیه‌سازی'], image: 'https://cdn.akamai.steamstatic.com/steam/apps/1868140/header.jpg?t=1701391511', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs3',
                fa_description: 'به گودال آبی مرموز خوش آمدید! دیو غواص یک بازی ماجراجویی تک‌نفره است که در آن روزها به غواصی و ماهیگیری و شب‌ها به مدیریت یک رستوران سوشی می‌پردازید. به دیو و دوستان عجیب و غریبش بپیوندید تا اسرار گودال آبی را کشف کنید.',
                fa_gameplay: 'حلقه گیم‌پلی بازی بسیار اعتیادآور است. در طول روز، در اعماق اقیانوس که هر بار تغییر می‌کند، غواصی کرده و با استفاده از نیزه و سلاح‌های دیگر، ماهی‌ها و موجودات دریایی را شکار می‌کنید. شب‌ها، با موادی که جمع کرده‌اید، در رستوران خود سوشی‌های خوشمزه درست کرده و به مشتریان می‌فروشید. درآمد حاصل را صرف ارتقای تجهیزات غواصی و رستوران می‌کنید.',
                fa_system_req: { minimum: 'Win 10, i3 Dual Core, 8GB RAM, Intel HD 530, 10GB HDD', recommended: 'Win 10, i5 Quad Core, 16GB RAM, GTX 1050Ti, 10GB SSD' },
                download_links: [{ part: 'خرید از استیم', url: 'https://store.steampowered.com/app/1868140/DAVE_THE_DIVER/' }]
            },
            { id: 21, title: 'Genshin Impact', fa_title: 'گنشین ایمپکت', category: 'mobile', isOnline: true, featured: true, rating: 4.4, release_date: '2020-09-28', developer: 'miHoYo', publisher: 'Cognosphere', genres: ['RPG', 'Gacha'], fa_genres: ['نقش‌آفرینی', 'گاچا'], image: 'https://upload.wikimedia.org/wikipedia/en/5/5d/Genshin_Impact_promotional_art.jpg', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs4',
              fa_description: 'گنشین ایمپکت یک بازی نقش‌آفرینی جهان‌باز و رایگان است که با گرافیک انیمه‌ای زیبا و سیستم مبارزات مبتنی بر عناصر، بازیکنان زیادی را به خود جذب کرده است. شما در دنیای وسیع و زیبای "تیوات" به ماجراجویی می‌پردازید، معماها را حل می‌کنید و داستان خدایان و هفت ملت را کشف می‌کنید.',
              fa_gameplay: 'شما می‌توانید تیمی چهار نفره از شخصیت‌های متنوع را کنترل کنید و در هر لحظه بین آن‌ها جابجا شوید. هر شخصیت دارای یک عنصر (آتش، آب، باد، و...) و مهارت‌های ویژه است. ترکیب عناصر مختلف برای ایجاد واکنش‌های قدرتمند (مانند بخار، انجماد، یا انفجار) هسته اصلی مبارزات بازی را تشکیل می‌دهد.',
              fa_system_req: { minimum: 'Android 7.0, 3GB RAM', recommended: 'Android 8.1+, 4GB+ RAM' },
              download_links: [{ part: 'دریافت از گوگل پلی', url: 'https://play.google.com/store/apps/details?id=com.miHoYo.GenshinImpact' }, { part: 'دریافت از اپ استور', url: 'https://apps.apple.com/us/app/genshin-impact/id1517783697' }]
            },
             { id: 23, title: 'Call of Duty: Mobile', fa_title: 'کال آو دیوتی موبایل', category: 'mobile', isOnline: true, featured: true, rating: 4.5, release_date: '2019-10-01', developer: 'TiMi Studio Group', publisher: 'Activision', genres: ['FPS', 'Shooter'], fa_genres: ['شوتر اول شخص', 'شوتر'], image: 'https://blog.activision.com/content/dam/atvi/activision/atvi-touchui/blog/callofduty/feature/mobile/Blog-Hero-Image-S1-Launch.jpg', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs5',
              fa_description: 'این بازی تجربه کلاسیک و سریع سری کال آو دیوتی را با حالت‌های چندنفره هیجان‌انگیز، نقشه‌های معروف و یک نقشه بتل رویال بزرگ به پلتفرم موبایل آورده است. گرافیک بالا، گیم‌پلی روان و تنوع بالای اسلحه‌ها و شخصی‌سازی، این بازی را به یکی از بهترین شوترهای موبایل تبدیل کرده است.',
              fa_gameplay: 'بازی شامل دو بخش اصلی است: مولتی‌پلیر و بتل رویال. در بخش مولتی‌پلیر، می‌توانید در مودهای مختلف از جمله Team Deathmatch، Domination و Kill-Confirmed در نقشه‌های کلاسیک مانند Nuketown و Crash رقابت کنید. بخش بتل رویال نیز ۱۰۰ بازیکن را در یک نقشه بزرگ برای بقا قرار می‌دهد.',
              fa_system_req: { minimum: 'Android 5.1, 2GB RAM', recommended: 'Android 9+, 4GB+ RAM' },
              download_links: [{ part: 'دریافت از گوگل پلی', url: 'https://play.google.com/store/apps/details?id=com.activision.callofduty.shooter' }]
            },
            { id: 24, title: 'Honkai: Star Rail', fa_title: 'هانکای: استار ریل', category: 'mobile', isOnline: true, featured: true, rating: 4.6, release_date: '2023-04-26', developer: 'miHoYo', publisher: 'Cognosphere', genres: ['RPG', 'Gacha'], fa_genres: ['نقش‌آفرینی', 'گاچا'], image: 'https://cdn2.unrealengine.com/honkai-star-rail-key-art-2560x1440-221ab32d3648.jpg', trailer_url: 'https://www.youtube.com/embed/QkkoHAzjnUs6',
                fa_description: 'سوار بر قطار فضایی "استرال اکسپرس" شوید و سفری شگفت‌انگیز را در میان ستارگان آغاز کنید. هانکای: استار ریل یک بازی نقش‌آفرینی فضایی جدید از سازندگان گنشین ایمپکت است. در این ماجراجویی کهکشانی، با همراهان جدیدی آشنا می‌شوید و اسرار "استلارون‌ها" را کشف می‌کنید.',
                fa_gameplay: 'برخلاف گنشین ایمپکت، مبارزات این بازی به صورت نوبتی (Turn-based) است. شما تیمی چهار نفره را تشکیل می‌دهید و با استفاده هوشمندانه از مهارت‌ها، حملات ویژه (Ultimate) و شکستن نقاط ضعف دشمنان، در نبردهای تاکتیکی پیروز می‌شوید. هر شخصیت در یک مسیر (Path) و نوع مبارزه (Element) تخصص دارد که عمق استراتژیک بازی را افزایش می‌دهد.',
                fa_system_req: { minimum: 'Android 9, 4GB RAM', recommended: 'Android 11+, 8GB+ RAM' },
                download_links: [{ part: 'دریافت از گوگل پلی', url: 'https://play.google.com/store/apps/details?id=com.HoYoverse.hkrpgoversea' }]
            }
        ];

        // ===== ADVANCED TRANSLATIONS =====
        const translations = {
            fa: { 
                app_title: 'گیم استور', search_placeholder: 'جستجوی بازی...', home_page: 'صفحه اصلی', profile: 'پروفایل', settings: 'تنظیمات', 
                featured_games: 'بازی‌های منتخب', all_games: 'همه بازی‌ها', pc_games: 'کامپیوتر', mobile_games: 'موبایل', no_results: 'موردی یافت نشد.', 
                no_wishlist_games: 'هنوز بازی‌ای به علاقه‌مندی‌ها اضافه نکرده‌اید.', back_to_home: 'بازگشت به صفحه اصلی', back_to_game: 'بازگشت به صفحه بازی', 
                signup: 'ثبت نام یا ورود', username: 'نام کاربری (ID)', password: 'رمز عبور', enter: 'ورود', display_name: 'نام نمایشی', 
                save_changes: 'ذخیره تغییرات', logout: 'خروج از حساب', ok: 'باشه', theme: 'تم برنامه', language: 'زبان', gameplay: 'گیم‌پلی', 
                description: 'توضیحات', online: 'آنلاین', offline: 'آفلاین', menu: 'منو', my_games: 'بازی های من', support: 'پشتیبانی', 
                changes_saved: 'تغییرات با موفقیت ذخیره شد.', game_added_to_wishlist: 'بازی به علاقه‌مندی‌ها اضافه شد', 
                game_removed_from_wishlist: 'بازی از علاقه‌مندی‌ها حذف شد', login_to_add_wishlist: 'برای افزودن به علاقه‌مندی‌ها، ابتدا وارد شوید.', 
                site_app: 'نصب برنامه', edit_profile: 'ویرایش پروفایل', email: 'ایمیل', bio: 'بیوگرافی', member_since: 'عضو از', level_gamer: 'گیمر', 
                system_req: 'سیستم مورد نیاز', minimum_req: 'حداقل سیستم', recommended_req: 'سیستم پیشنهادی', appearance: 'ظاهر', 
                data_privacy: 'داده و حریم خصوصی', clear_cache: 'پاک کردن حافظه پنهان و بازنشانی کامل', confirm: 'تایید', cancel: 'لغو', 
                clear_cache_confirm: 'آیا مطمئن هستید؟ تمام اطلاعات پروفایل‌ها و تنظیمات شما از این مرورگر پاک خواهد شد.', rating: 'امتیاز', release_date: 'تاریخ انتشار', 
                genres: 'ژانرها', add_to_wishlist: 'افزودن به علاقه‌مندی‌ها', remove_from_wishlist: 'حذف از علاقه‌مندی‌ها', all: 'همه', 
                filter_category: 'دسته‌بندی', filter_status: 'وضعیت', sort_by: 'مرتب‌سازی بر اساس', sort_default: 'پیش‌فرض', 
                sort_title_asc: 'نام (صعودی)', sort_title_desc: 'نام (نزولی)', sort_rating_desc: 'امتیاز (بیشترین)', sort_date_desc: 'تاریخ انتشار (جدیدترین)', 
                category: 'دسته‌بندی', status: 'وضعیت', trailer: 'تریلر', download_page_title: 'صفحه دانلود بازی', download_links: 'لینک‌های دانلود', 
                download_now: 'دریافت بازی', profile_stats: 'آمار پروفایل', stats_wishlist_count: 'بازی در علاقه‌مندی‌ها', social_twitter: 'توییتر', 
                social_steam: 'استیم', activity_feed: 'فید فعالیت', activity_added_to_wishlist: 'را به علاقه‌مندی‌ها اضافه کرد.', 
                preferences: 'ترجیحات', enable_notifications: 'فعال‌سازی نوتیفیکیشن‌ها', enable_animations: 'فعال‌سازی انیمیشن‌ها', 
                reset_settings: 'بازنشانی تنظیمات به پیش‌فرض', export_data: 'خروجی گرفتن از داده‌ها', import_data: 'ورودی گرفتن داده‌ها', 
                import_success: 'داده‌ها با موفقیت وارد شد. لطفا دوباره وارد شوید.', import_fail: 'فایل نامعتبر است.', 
                reset_settings_confirm: 'آیا می‌خواهید تمام تنظیمات کاربری (ترجیحات) به حالت پیش‌فرض بازگردد؟', 
                support_page_title: 'پشتیبانی و راهنما', faq_title: 'سوالات متداول',
                faq_q1: 'چگونه زبان یا تم برنامه را تغییر دهم؟', faq_a1: 'از منوی کناری به بخش "تنظیمات" بروید. در کارت "ظاهر" می‌توانید تم و زبان دلخواه خود را انتخاب کنید.',
                faq_q2: 'اطلاعات پروفایل من کجا ذخیره می‌شود؟', faq_a2: 'تمام اطلاعات پروفایل شما (نام، لیست علاقه‌مندی‌ها و تنظیمات) به صورت امن در حافظه مرورگر شما و تحت نام کاربری‌تان ذخیره می‌شود. با ورود مجدد با همان نام کاربری، اطلاعات شما باقی خواهد ماند.',
                faq_q3: 'چگونه از اطلاعاتم خروجی بگیرم؟', faq_a3: 'در صفحه "تنظیمات"، بخش "داده و حریم خصوصی"، می‌توانید با کلیک بر روی دکمه "خروجی گرفتن از داده‌ها" یک فایل پشتیبان از اطلاعات پروفایل خود دانلود کنید.',
                contact_us_title: 'ارتباط با ما', social_media_title: 'ما را در شبکه‌های اجتماعی دنبال کنید',
                contact_form_name: 'نام شما', contact_form_message: 'پیام شما', contact_form_send: 'ارسال پیام', 
                message_sent_successfully: 'پیام شما با موفقیت ارسال شد!', developer: 'توسعه‌دهنده', publisher: 'ناشر',
                theme_light: 'روشن', theme_dark: 'تاریک', theme_midnight: 'نیمه‌شب', theme_dracula: 'دراکولا', theme_sepia: 'سپیا', theme_forest: 'جنگل',
                font_size: 'اندازه فونت', font_size_small: 'کوچک', font_size_normal: 'متوسط', font_size_large: 'بزرگ',
                login_helper_text: 'اگر نام کاربری وجود نداشته باشد، یک حساب جدید با این رمز ساخته می‌شود.',
                login_successful: 'ورود با موفقیت انجام شد.',
                logout_successful: 'خروج با موفقیت انجام شد.',
                login_failed: 'نام کاربری یا رمز عبور اشتباه است.'
            },
            en: { /* English translations would go here... */ }
        };

        // ===== APP STATE & DOM ELEMENTS =====
        let currentLang = 'fa';
        let currentUser = null;
        let currentGameContext = null; 
        const DOMElements = {
            html: document.documentElement,
            appContainer: document.getElementById('app-container'),
            splashScreen: document.getElementById('splash-screen'),
            pages: { home: document.getElementById('home-page'), gameDetail: document.getElementById('game-detail-page'), download: document.getElementById('download-page'), myGames: document.getElementById('my-games-page'), profile: document.getElementById('profile-page'), settings: document.getElementById('settings-page'), support: document.getElementById('support-page') },
            sidebar: { self: document.getElementById('sidebar'), overlay: document.getElementById('sidebar-overlay'), toggleBtn: document.getElementById('sidebar-toggle-btn'), closeBtn: document.getElementById('close-sidebar-btn') },
            links: { home: document.getElementById('sidebar-home-btn'), profile: document.getElementById('sidebar-profile-btn'), myGames: document.getElementById('sidebar-my-games-btn'), settings: document.getElementById('sidebar-settings-btn'), support: document.getElementById('sidebar-support-btn') },
            home: { featuredCarousel: document.getElementById('featured-carousel'), prevBtn: document.getElementById('prev-btn'), nextBtn: document.getElementById('next-btn'), gamesGrid: document.getElementById('games-grid'), searchInputs: [document.getElementById('search-input'), document.getElementById('search-input-mobile')], filters: { category: document.getElementById('filter-category'), status: document.getElementById('filter-status'), sortBy: document.getElementById('sort-by') } },
            profile: { authSection: document.getElementById('auth-section'), userProfileSection: document.getElementById('user-profile-section'), signupForm: document.getElementById('signup-form'), profileForm: document.getElementById('profile-form'), logoutBtn: document.getElementById('logout-btn'), picDisplay: document.getElementById('profile-pic-display'), picUpload: document.getElementById('profile-pic-upload'), changePicBtn: document.getElementById('change-pic-btn'), displayName: document.getElementById('profile-display-name'), username: document.getElementById('profile-username'), memberSince: document.getElementById('member-since'), statsList: document.getElementById('profile-stats-list'), activityFeed: document.getElementById('activity-feed-container'), formDisplayName: document.getElementById('form-display-name'), formEmail: document.getElementById('form-email'), formBio: document.getElementById('form-bio'), formSocialTwitter: document.getElementById('form-social-twitter'), formSocialSteam: document.getElementById('form-social-steam') },
            settings: { themeSelect: document.getElementById('theme-select'), langSelect: document.getElementById('language-select'), fontSizeSelect: document.getElementById('font-size-select'), notificationsToggle: document.getElementById('pref-notifications-toggle'), animationsToggle: document.getElementById('pref-animations-toggle'), resetBtn: document.getElementById('reset-settings-btn'), exportBtn: document.getElementById('export-data-btn'), importBtn: document.getElementById('import-data-btn'), importInput: document.getElementById('import-file-input'), clearCacheBtn: document.getElementById('clear-cache-btn') },
            common: { loader: document.getElementById('loader-container'), noResults: document.getElementById('no-results'), modal: document.getElementById('modal'), modalTitle: document.getElementById('modal-title'), modalText: document.getElementById('modal-text'), modalConfirmBtn: document.getElementById('modal-confirm-btn'), modalCancelBtn: document.getElementById('modal-cancel-btn'), toastContainer: document.getElementById('toast-container') }
        };

        // ===== SECURE PASSWORD & USER FUNCTIONS =====
        const getAllUsers = () => JSON.parse(localStorage.getItem('gameStoreUsers')) || {};
        const saveAllUsers = (users) => localStorage.setItem('gameStoreUsers', JSON.stringify(users));

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function loginUser(username, password) {
            const allUsers = getAllUsers();
            const userExists = allUsers[username];
            const passwordHash = await hashPassword(password);

            if (userExists) { // Login attempt
                if (userExists.passwordHash === passwordHash) {
                    currentUser = userExists;
                    localStorage.setItem('lastLoggedInUser', username);
                    showToast('login_successful');
                    navigateTo('profile');
                    applySettings();
                } else {
                    showToast('login_failed');
                }
            } else { // Registration
                currentUser = {
                    username: username, name: username,
                    passwordHash: passwordHash,
                    email: '', bio: '', profilePic: '', socials: { twitter: '', steam: '' },
                    memberSince: new Date().toISOString(),
                    wishlist: [], settings: getDefaultUserSettings()
                };
                allUsers[username] = currentUser;
                saveAllUsers(allUsers);
                localStorage.setItem('lastLoggedInUser', username);
                showToast('login_successful');
                navigateTo('profile');
                applySettings();
            }
        }

        const saveCurrentUser = () => {
            if (!currentUser) return;
            const allUsers = getAllUsers();
            allUsers[currentUser.username] = currentUser;
            saveAllUsers(allUsers);
        };

        const logoutUser = () => {
            showToast('logout_successful');
            currentUser = null;
            localStorage.removeItem('lastLoggedInUser');
            navigateTo('home');
            applySettings();
        };
        
        const loadUserOnStartup = () => {
            const lastUser = localStorage.getItem('lastLoggedInUser');
            if (lastUser) {
                const allUsers = getAllUsers();
                if (allUsers[lastUser]) { currentUser = allUsers[lastUser]; }
            }
        };

        // ===== HELPER & CORE FUNCTIONS =====
        const closeSidebar = () => { DOMElements.sidebar.self.classList.remove('open'); DOMElements.sidebar.overlay.classList.add('hidden'); };

        const navigateTo = (pageKey, context = null) => {
            Object.values(DOMElements.pages).forEach(p => p.classList.add('hidden'));
            const targetPage = DOMElements.pages[pageKey];
            if (targetPage) {
                targetPage.classList.remove('hidden');
                if(pageKey === 'gameDetail' && context) { currentGameContext = context; renderGameDetailPage(context); }
                else if(pageKey === 'download' && context) renderDownloadPage(context);
                else if(pageKey === 'myGames') renderMyGamesPage();
                else if(pageKey === 'profile') renderProfilePage();
                else if(pageKey === 'support') renderSupportPage();
                else if(pageKey === 'settings') renderSettingsPage();
                else if(pageKey === 'home') { currentGameContext = null; renderFilteredGames(); }
            }
            window.scrollTo(0, 0);
            closeSidebar();
        };

        const showToast = (messageKey, duration = 3000) => {
            if (currentUser?.settings?.showNotifications === false && messageKey !== 'login_to_add_wishlist') return;
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = translations[currentLang][messageKey] || messageKey;
            DOMElements.common.toastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, duration);
        };
        
        const showModal = (titleKey, messageKey, showConfirm = false, onConfirm = null) => {
            DOMElements.common.modalTitle.textContent = translations[currentLang][titleKey] || titleKey;
            DOMElements.common.modalText.textContent = translations[currentLang][messageKey] || messageKey;
            DOMElements.common.modalConfirmBtn.style.display = showConfirm ? 'block' : 'none';
            DOMElements.common.modalCancelBtn.textContent = translations[currentLang][showConfirm ? 'cancel' : 'ok'];
            DOMElements.common.modal.classList.remove('hidden');
            if (showConfirm && onConfirm) {
                const newConfirmBtn = DOMElements.common.modalConfirmBtn.cloneNode(true);
                DOMElements.common.modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, DOMElements.common.modalConfirmBtn);
                DOMElements.common.modalConfirmBtn = newConfirmBtn;
                DOMElements.common.modalConfirmBtn.addEventListener('click', () => { onConfirm(); closeModal(); });
            }
        };

        const closeModal = () => DOMElements.common.modal.classList.add('hidden');
        const showLoader = () => DOMElements.common.loader.classList.remove('hidden');
        const hideLoader = () => DOMElements.common.loader.classList.add('hidden');

        const updateLanguage = () => {
            const lang = DOMElements.settings.langSelect.value;
            currentLang = lang;
            localStorage.setItem('lang', currentLang);
            DOMElements.html.lang = lang;
            DOMElements.html.dir = lang === 'fa' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) { el.textContent = translations[lang][key]; }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                if (translations[lang] && translations[lang][key]) { el.placeholder = translations[lang][key]; }
            });
        };
        
        const applySettings = () => {
            // Apply Theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            DOMElements.html.classList.remove('light', 'dark', 'midnight', 'dracula', 'sepia', 'forest');
            DOMElements.html.classList.add(savedTheme);
            DOMElements.settings.themeSelect.value = savedTheme;

            // Apply Language
            DOMElements.settings.langSelect.value = localStorage.getItem('lang') || 'fa';
            updateLanguage();

            // Apply User-Specific Settings
            const settings = currentUser ? currentUser.settings : getDefaultUserSettings();
            DOMElements.html.classList.remove('font-size-small', 'font-size-normal', 'font-size-large');
            if(settings.fontSize !== 'normal') DOMElements.html.classList.add(`font-size-${settings.fontSize}`);
            DOMElements.settings.fontSizeSelect.value = settings.fontSize;
            DOMElements.html.classList.toggle('no-animations', !settings.showAnimations);
            DOMElements.settings.animationsToggle.checked = settings.showAnimations;
            DOMElements.settings.notificationsToggle.checked = settings.showNotifications;
            
            // Disable preference controls if not logged in
            const prefControls = [DOMElements.settings.fontSizeSelect, DOMElements.settings.animationsToggle, DOMElements.settings.notificationsToggle, DOMElements.settings.resetBtn, DOMElements.settings.exportBtn, DOMElements.settings.importBtn];
            prefControls.forEach(control => {
                control.disabled = !currentUser;
                const parentDiv = control.closest('div');
                if (parentDiv) {
                    parentDiv.classList.toggle('opacity-50', !currentUser);
                    parentDiv.classList.toggle('pointer-events-none', !currentUser);
                }
            });
        };

        const getDefaultUserSettings = () => ({ showAnimations: true, showNotifications: true, fontSize: 'normal' });

        // ===== RENDER FUNCTIONS =====
        const getStarRatingHTML = (rating) => {
            let stars = ''; const full = Math.floor(rating); const half = rating % 1 >= 0.5;
            for(let i=0; i<full; i++) stars += '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
            if(half) stars += '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292zM10 12.433V4.032l-.836 2.57H6.38l2.135 1.55-.815 2.51 2.29-1.666z"/></svg>';
            const empty = 5 - Math.ceil(rating); for(let i=0; i<empty; i++) stars += '<svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
            return `<div class="flex items-center gap-1 star-rating">${stars}</div>`;
        };
        const createGameCard = (game) => {
            const title = currentLang === 'fa' ? game.fa_title : game.title;
            return `<div class="game-card bg-secondary rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col" data-id="${game.id}">
                        <img src="${game.image}" alt="${title}" class="w-full h-40 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/2c2c2c/a0a0a0?text=Image+Error';">
                        <div class="p-3 flex flex-col flex-grow">
                            <h3 class="font-bold text-md truncate text-primary">${title}</h3>
                            <div class="mt-2 flex justify-between items-center text-secondary text-xs">
                                ${getStarRatingHTML(game.rating)}<span class="font-semibold">${game.rating.toFixed(1)}</span>
                            </div>
                        </div>
                    </div>`;
        };
        const renderFilteredGames = () => {
            showLoader(); DOMElements.home.gamesGrid.innerHTML = '';
            setTimeout(() => {
                const searchTerm = (DOMElements.home.searchInputs[0].value || DOMElements.home.searchInputs[1].value).toLowerCase().trim();
                const categoryFilter = DOMElements.home.filters.category.value;
                const statusFilter = DOMElements.home.filters.status.value;
                const sortBy = DOMElements.home.filters.sortBy.value;
                let filtered = games.filter(g => {
                    const titleMatch = g.title.toLowerCase().includes(searchTerm) || g.fa_title.toLowerCase().includes(searchTerm);
                    const categoryMatch = categoryFilter === 'all' || g.category === categoryFilter;
                    const statusMatch = statusFilter === 'all' || String(g.isOnline) === statusFilter;
                    return titleMatch && categoryMatch && statusMatch;
                });
                filtered.sort((a, b) => {
                    const titleA = (currentLang === 'fa' ? a.fa_title : a.title).toLowerCase();
                    const titleB = (currentLang === 'fa' ? b.fa_title : b.title).toLowerCase();
                    switch (sortBy) {
                        case 'title-asc': return titleA.localeCompare(titleB);
                        case 'title-desc': return titleB.localeCompare(titleA);
                        case 'rating-desc': return b.rating - a.rating;
                        case 'date-desc': return new Date(b.release_date) - new Date(a.release_date);
                        default: return a.id - b.id;
                    }
                });
                DOMElements.home.gamesGrid.innerHTML = filtered.map(createGameCard).join('');
                DOMElements.common.noResults.classList.toggle('hidden', filtered.length > 0);
                hideLoader();
            }, 300);
        };
        const renderFeaturedGames = () => {
            const featured = games.filter(g => g.featured);
            DOMElements.home.featuredCarousel.innerHTML = featured.map(g => `<div class="game-card snap-center flex-shrink-0 w-3/4 sm:w-1/2 md:w-1/3 lg:w-1/4 p-2" data-id="${g.id}"><div class="relative rounded-lg overflow-hidden shadow-lg cursor-pointer"><img src="${g.image}" alt="${g.fa_title}" class="w-full h-48 object-cover"  onerror="this.onerror=null;this.src='https://placehold.co/600x400/2c2c2c/a0a0a0?text=Image+Error';"><div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent"><h3 class="text-white font-bold text-lg">${currentLang === 'fa' ? g.fa_title : g.title}</h3></div></div></div>`).join('');
        };
        
        const renderGameDetailPage = (game) => {
             const title = currentLang === 'fa' ? game.fa_title : game.title;
             const description = game.fa_description || '';
             const gameplay = game.fa_gameplay || '';
             const genres = currentLang === 'fa' ? game.fa_genres : game.genres;
             const sys_req = game.fa_system_req;
             DOMElements.pages.gameDetail.innerHTML = `
                <div class="container mx-auto p-4 md:p-8">
                    <button class="back-btn mb-6 text-primary hover:accent-text" data-page="home">→ <span data-translate="back_to_home"></span></button>
                    <div class="bg-secondary rounded-lg shadow-xl overflow-hidden">
                        <div class="relative"><img src="${game.image}" alt="${title}" class="w-full h-48 md:h-64 lg:h-80 object-cover object-top" onerror="this.onerror=null;this.src='https://placehold.co/1280x480/2c2c2c/a0a0a0?text=Image+Error';"><div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/90 to-transparent"><h1 class="text-3xl md:text-5xl font-bold text-white">${title}</h1><div class="mt-2 flex items-center gap-2">${getStarRatingHTML(game.rating)} <span class="text-white text-lg font-bold">${game.rating.toFixed(1)}</span></div></div></div>
                        <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="md:col-span-2 space-y-8">
                                <div><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="description"></h2><p class="text-secondary leading-relaxed">${description}</p></div>
                                ${gameplay ? `<div><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="gameplay"></h2><p class="text-secondary leading-relaxed">${gameplay}</p></div>` : ''}
                                <div><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="trailer"></h2><div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden bg-tertiary"><iframe src="${game.trailer_url}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe></div></div>
                                ${sys_req ? `<div><h2 class="text-2xl font-bold mb-4 text-primary" data-translate="system_req"></h2><div class="grid grid-cols-1 sm:grid-cols-2 gap-6"><div class="bg-tertiary p-4 rounded-lg"><h3 class="text-lg font-semibold mb-2 text-primary" data-translate="minimum_req"></h3><p class="text-secondary text-sm whitespace-pre-line">${sys_req.minimum || ''}</p></div><div class="bg-tertiary p-4 rounded-lg"><h3 class="text-lg font-semibold mb-2 text-primary" data-translate="recommended_req"></h3><p class="text-secondary text-sm whitespace-pre-line">${sys_req.recommended || ''}</p></div></div></div>` : ''}
                            </div>
                            <div class="md:col-span-1"><div class="bg-tertiary p-6 rounded-lg sticky top-24"><button class="download-btn w-full accent-bg text-white font-bold py-3 px-4 rounded-lg accent-bg-hover text-lg" data-game-id="${game.id}" data-translate="download_now"></button><button id="wishlist-btn" class="mt-4 w-full font-bold py-3 px-4 rounded-lg text-lg" data-game-id="${game.id}"></button>
                            <ul class="mt-6 space-y-3 text-sm">
                                <li class="flex justify-between"><span class="text-secondary" data-translate="release_date"></span> <span class="font-semibold text-primary">${new Date(game.release_date).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US')}</span></li>
                                <li class="flex justify-between"><span class="text-secondary" data-translate="developer"></span> <span class="font-semibold text-primary text-right">${game.developer || ''}</span></li>
                                <li class="flex justify-between"><span class="text-secondary" data-translate="publisher"></span> <span class="font-semibold text-primary text-right">${game.publisher || ''}</span></li>
                                <li class="flex items-start justify-between"><span class="text-secondary" data-translate="genres"></span><div class="flex flex-wrap gap-1 justify-end">${genres.map(g => `<span class="bg-primary px-2 py-1 rounded-md text-xs font-medium">${g}</span>`).join('')}</div></li>
                            </ul></div></div>
                        </div>
                    </div>
                </div>`;
             updateWishlistButton(game.id);
             updateLanguage(); // To translate any newly added text
        };

        const renderDownloadPage = (game) => {
            const title = currentLang === 'fa' ? game.fa_title : game.title;
            DOMElements.pages.download.innerHTML = `
                <div class="container mx-auto p-4 md:p-8 max-w-4xl">
                    <button class="back-btn mb-6 text-primary hover:accent-text" data-page="gameDetail">→ <span data-translate="back_to_game"></span></button>
                    <div class="bg-secondary p-8 rounded-lg shadow-lg">
                        <div class="flex flex-col sm:flex-row items-center gap-6 mb-8"><img src="${game.image}" class="w-32 h-40 object-cover rounded-lg shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/128x160/2c2c2c/a0a0a0?text=Image';"><div><h1 class="text-3xl md:text-4xl font-bold text-primary">${title}</h1><p class="text-secondary mt-2" data-translate="download_page_title"></p></div></div>
                        <h2 class="text-2xl font-bold mb-4 text-primary" data-translate="download_links"></h2><div class="space-y-3">${game.download_links.map(link => `<a href="${link.url}" target="_blank" class="block w-full text-center accent-bg text-white font-bold py-3 px-4 rounded-lg accent-bg-hover transition-colors">${link.part}</a>`).join('')}</div>
                    </div>
                </div>`;
            updateLanguage();
        };

        const renderMyGamesPage = () => {
             let content;
             if (!currentUser) {
                 content = `<div class="text-center py-20"><p class="text-secondary text-lg" data-translate="login_to_add_wishlist"></p></div>`;
             } else if (!currentUser.wishlist || currentUser.wishlist.length === 0) {
                 content = `<div class="text-center py-20"><p class="text-secondary text-lg" data-translate="no_wishlist_games"></p></div>`;
             } else {
                 const wishlistGames = currentUser.wishlist.map(item => games.find(g => g.id === item.id)).filter(Boolean);
                 content = `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">${wishlistGames.map(createGameCard).join('')}</div>`;
             }
             DOMElements.pages.myGames.innerHTML = `<div class="container mx-auto p-4 md:p-8"><button class="back-btn mb-4 text-primary hover:accent-text" data-page="home">→ <span data-translate="back_to_home"></span></button><h1 class="text-3xl font-bold text-primary mb-8" data-translate="my_games"></h1>${content}</div>`;
             updateLanguage();
        };

        const renderProfilePage = () => {
             if (!currentUser) {
                DOMElements.profile.authSection.classList.remove('hidden');
                DOMElements.profile.userProfileSection.classList.add('hidden');
             } else {
                DOMElements.profile.authSection.classList.add('hidden');
                DOMElements.profile.userProfileSection.classList.remove('hidden');
                DOMElements.profile.picDisplay.src = currentUser.profilePic || 'https://placehold.co/128x128/2c2c2c/a0a0a0?text=User';
                DOMElements.profile.displayName.textContent = currentUser.name || currentUser.username;
                DOMElements.profile.username.textContent = `@${currentUser.username}`;
                DOMElements.profile.memberSince.textContent = new Date(currentUser.memberSince).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
                DOMElements.profile.formDisplayName.value = currentUser.name || '';
                DOMElements.profile.formEmail.value = currentUser.email || '';
                DOMElements.profile.formBio.value = currentUser.bio || '';
                DOMElements.profile.formSocialTwitter.value = currentUser.socials?.twitter || '';
                DOMElements.profile.formSocialSteam.value = currentUser.socials?.steam || '';
                const wishlistCount = currentUser.wishlist?.length || 0;
                DOMElements.profile.statsList.innerHTML = `<li class="flex justify-between items-center"><span data-translate="stats_wishlist_count"></span><span class="font-bold text-primary text-lg">${wishlistCount}</span></li>`;
                const sortedWishlist = [...(currentUser.wishlist || [])].sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
                DOMElements.profile.activityFeed.innerHTML = sortedWishlist.length > 0 ? sortedWishlist.map(item => {
                    const game = games.find(g => g.id === item.id);
                    if (!game) return '';
                    const gameTitle = currentLang === 'fa' ? game.fa_title : game.title;
                    const date = new Date(item.addedAt).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
                    return `<div class="text-sm border-r-2 accent-text pr-3"><span class="font-bold">${gameTitle}</span> <span class="text-secondary" data-translate="activity_added_to_wishlist"></span> <span class="text-xs text-secondary">(${date})</span></div>`;
                }).join('') : `<p class="text-center text-secondary text-sm">${translations[currentLang].no_wishlist_games}</p>`;
             }
             updateLanguage();
        };
        const renderSettingsPage = () => { applySettings(); };

        const renderSupportPage = () => {
            DOMElements.pages.support.innerHTML = `
            <div class="container mx-auto p-4 md:p-8 max-w-4xl">
                <button class="back-btn mb-6 text-primary hover:accent-text" data-page="home">→ <span data-translate="back_to_home"></span></button>
                <h1 class="text-3xl font-bold text-primary mb-8" data-translate="support_page_title"></h1>
                <div class="space-y-8">
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="faq_title"></h3>
                        <div class="space-y-4">
                            <div class="faq-item"><details><summary class="font-semibold" data-translate="faq_q1"></summary><p class="mt-2 text-secondary p-2 bg-tertiary rounded-md" data-translate="faq_a1"></p></details></div><hr class="border-color/50">
                            <div class="faq-item"><details><summary class="font-semibold" data-translate="faq_q2"></summary><p class="mt-2 text-secondary p-2 bg-tertiary rounded-md" data-translate="faq_a2"></p></details></div><hr class="border-color/50">
                            <div class="faq-item"><details><summary class="font-semibold" data-translate="faq_q3"></summary><p class="mt-2 text-secondary p-2 bg-tertiary rounded-md" data-translate="faq_a3"></p></details></div>
                        </div>
                    </div>
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="social_media_title"></h3>
                        <div class="flex items-center justify-center gap-6">
                           <a href="#" class="text-secondary hover:accent-text transition-colors" aria-label="Discord"><svg class="w-10 h-10" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path fill="currentColor" d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3847-.3973-.8742-.6177-1.2495a.077.077 0 00-.0785-.0371A19.921 19.921 0 003.766 4.3698a.077.077 0 00-.0525.0741v11.3653c0 .041.022.0762.0576.0934a17.204 17.204 0 005.5838 2.654.0729.0729 0 00.0883-.0202c.2892-.322.5499-.67.7738-1.033a.0718.0718 0 00-.041-.1023 12.33 12.33 0 01-2.2279-.9622.0741.0741 0 01-.0106-.1175c.0106-.01.0212-.0212.0318-.0212.8232- .4447 1.6146-.8648 2.3742-1.2591a.077.077 0 01.1012.0106c2.0275 1.2388 4.331 1.2388 6.3681 0a.077.077 0 01.1012-.0106c.7596.3944 1.551.8144 2.3742 1.2591.0106 0 .0212.0106.0318.0212a.0741.0741 0 01-.0106.1175 12.33 12.33 0 01-2.2279.9622.0718.0718 0 00-.041.1023c.2239.363.4846.713.7738 1.033a.0729.0729 0 00.0883.0202 17.204 17.204 0 005.5838-2.654.077.077 0 00.0576-.0934V4.444a.077.077 0 00-.0525-.0741zM8.4223 12.6111c-.8648 0-1.562-.68-1.562-1.5152s.6972-1.5152 1.562-1.5152c.8648 0 1.562.68 1.562 1.5152s-.6972 1.5152-1.562 1.5152zm7.149 0c-.8648 0-1.562-.68-1.562-1.5152s.6972-1.5152 1.562-1.5152c.8648 0 1.562.68 1.562 1.5152.0001.8352-.6971 1.5152-1.562 1.5152z"/></svg></a>
                           <a href="#" class="text-secondary hover:accent-text transition-colors" aria-label="X/Twitter"><svg class="w-10 h-10" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path fill="currentColor" d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></a>
                        </div>
                    </div>
                    <div class="bg-secondary p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold text-primary mb-4" data-translate="contact_us_title"></h3>
                        <form id="contact-form">
                            <div class="mb-4"><label for="contact-name" class="block mb-2 text-sm font-medium text-secondary" data-translate="contact_form_name"></label><input type="text" id="contact-name" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary focus:ring-2 focus-ring-accent" required></div>
                            <div class="mb-4"><label for="contact-message" class="block mb-2 text-sm font-medium text-secondary" data-translate="contact_form_message"></label><textarea id="contact-message" rows="4" class="w-full bg-tertiary border border-color rounded-lg p-2.5 text-primary focus:ring-2 focus-ring-accent" required></textarea></div>
                            <button type="submit" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700" data-translate="contact_form_send"></button>
                        </form>
                    </div>
                </div>
            </div>`;
            updateLanguage();
        };
        
        // ===== EVENT HANDLERS & LOGIC =====
        const handleWishlistToggle = (gameId) => {
            if (!currentUser) { showToast('login_to_add_wishlist'); return; }
            const index = currentUser.wishlist.findIndex(item => item.id === gameId);
            if (index > -1) {
                currentUser.wishlist.splice(index, 1);
                showToast('game_removed_from_wishlist');
            } else {
                currentUser.wishlist.push({ id: gameId, addedAt: new Date().toISOString() });
                showToast('game_added_to_wishlist');
            }
            saveCurrentUser();
            updateWishlistButton(gameId);
        };
        const updateWishlistButton = (gameId) => {
            const btn = DOMElements.pages.gameDetail.querySelector(`#wishlist-btn[data-game-id="${gameId}"]`);
            if (!btn) return;
            const isInWishlist = currentUser?.wishlist?.some(item => item.id === gameId);
            btn.textContent = translations[currentLang][isInWishlist ? 'remove_from_wishlist' : 'add_to_wishlist'];
            btn.className = `mt-4 w-full font-bold py-3 px-4 rounded-lg text-lg transition-colors ${isInWishlist ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white'}`;
        };
        
        const exportUserData = () => {
            if(!currentUser) return;
            const dataStr = JSON.stringify(currentUser, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gamestore_backup_${currentUser.username}.json`;
            a.click();
            URL.revokeObjectURL(url);
        };

        const importUserData = (event) => {
            const file = event.target.files[0];
            if(!file || !currentUser) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedUser = JSON.parse(e.target.result);
                    if(importedUser.username && importedUser.wishlist) {
                        importedUser.username = currentUser.username; // Keep current username
                        importedUser.passwordHash = currentUser.passwordHash; // Keep current hash
                        currentUser = importedUser;
                        saveCurrentUser();
                        showToast('import_success');
                        setTimeout(() => { logoutUser(); }, 1500);
                    } else { throw new Error('Invalid file'); }
                } catch (error) { showModal('import_data', 'import_fail'); }
            };
            reader.readAsText(file);
            event.target.value = '';
        };

        const setupEventListeners = () => {
            // Sidebar Navigation
            DOMElements.sidebar.toggleBtn.addEventListener('click', () => { DOMElements.sidebar.self.classList.add('open'); DOMElements.sidebar.overlay.classList.remove('hidden'); });
            [DOMElements.sidebar.closeBtn, DOMElements.sidebar.overlay].forEach(el => el.addEventListener('click', closeSidebar));
            Object.entries(DOMElements.links).forEach(([key, link]) => link.addEventListener('click', (e) => { e.preventDefault(); navigateTo(key); }));

            // Body-level Clicks
            document.body.addEventListener('click', (e) => {
                const backBtn = e.target.closest('.back-btn');
                if(backBtn) { e.preventDefault(); const targetPage = backBtn.dataset.page; navigateTo(targetPage, targetPage === 'gameDetail' ? currentGameContext : null); }
                const gameCard = e.target.closest('.game-card');
                if(gameCard?.dataset.id) { const game = games.find(g => g.id === parseInt(gameCard.dataset.id)); if(game) navigateTo('gameDetail', game); }
                const downloadBtn = e.target.closest('.download-btn');
                if(downloadBtn) { const game = games.find(g => g.id === parseInt(downloadBtn.dataset.gameId)); if(game) navigateTo('download', game); }
                const wishlistBtn = e.target.closest('#wishlist-btn');
                if(wishlistBtn) { handleWishlistToggle(parseInt(wishlistBtn.dataset.gameId)); }
            });

            // Home Page
            DOMElements.home.searchInputs.forEach(input => input.addEventListener('input', renderFilteredGames));
            Object.values(DOMElements.home.filters).forEach(select => select.addEventListener('change', renderFilteredGames));
            DOMElements.home.prevBtn.addEventListener('click', () => DOMElements.home.featuredCarousel.scrollBy({ left: -DOMElements.home.featuredCarousel.clientWidth, behavior: 'smooth' }));
            DOMElements.home.nextBtn.addEventListener('click', () => DOMElements.home.featuredCarousel.scrollBy({ left: DOMElements.home.featuredCarousel.clientWidth, behavior: 'smooth' }));

            // Auth & Profile
            DOMElements.profile.signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const usernameInput = DOMElements.profile.signupForm.querySelector('#username');
                const passwordInput = DOMElements.profile.signupForm.querySelector('#password');
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                if (username && password) {
                    await loginUser(username, password);
                }
                usernameInput.value = '';
                passwordInput.value = '';
            });
            DOMElements.profile.logoutBtn.addEventListener('click', logoutUser);
            DOMElements.profile.changePicBtn.addEventListener('click', () => DOMElements.profile.picUpload.click());
            DOMElements.profile.picUpload.addEventListener('change', (e) => {
                if(!currentUser || !e.target.files?.[0]) return;
                const reader = new FileReader();
                reader.onload = (event) => { currentUser.profilePic = event.target.result; saveCurrentUser(); renderProfilePage(); };
                reader.readAsDataURL(e.target.files[0]);
            });
            DOMElements.profile.profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if(!currentUser) return;
                currentUser.name = DOMElements.profile.formDisplayName.value;
                currentUser.email = DOMElements.profile.formEmail.value;
                currentUser.bio = DOMElements.profile.formBio.value;
                currentUser.socials = { twitter: DOMElements.profile.formSocialTwitter.value, steam: DOMElements.profile.formSocialSteam.value };
                saveCurrentUser();
                showToast('changes_saved');
                renderProfilePage();
            });

            // Settings Page
            DOMElements.settings.themeSelect.addEventListener('change', (e) => { localStorage.setItem('theme', e.target.value); applySettings(); });
            DOMElements.settings.langSelect.addEventListener('change', () => { applySettings(); renderFeaturedGames(); renderFilteredGames(); });
            DOMElements.settings.fontSizeSelect.addEventListener('change', (e) => { if(currentUser) { currentUser.settings.fontSize = e.target.value; saveCurrentUser(); applySettings(); }});
            DOMElements.settings.animationsToggle.addEventListener('change', (e) => { if(currentUser) { currentUser.settings.showAnimations = e.target.checked; saveCurrentUser(); applySettings(); } });
            DOMElements.settings.notificationsToggle.addEventListener('change', (e) => { if(currentUser) { currentUser.settings.showNotifications = e.target.checked; saveCurrentUser(); } });
            DOMElements.settings.resetBtn.addEventListener('click', () => { if(currentUser) { showModal('reset_settings', 'reset_settings_confirm', true, () => { currentUser.settings = getDefaultUserSettings(); saveCurrentUser(); applySettings(); showToast('changes_saved'); }); } });
            DOMElements.settings.exportBtn.addEventListener('click', exportUserData);
            DOMElements.settings.importBtn.addEventListener('click', () => DOMElements.settings.importInput.click());
            DOMElements.settings.importInput.addEventListener('change', importUserData);
            DOMElements.settings.clearCacheBtn.addEventListener('click', () => { showModal('clear_cache', 'clear_cache_confirm', true, () => { localStorage.clear(); location.reload(); }); });
            
            // Support Form
            DOMElements.pages.support.addEventListener('submit', (e) => { if(e.target.id === 'contact-form'){ e.preventDefault(); showToast('message_sent_successfully'); e.target.reset(); } });
            
            // Modal
            DOMElements.common.modalCancelBtn.addEventListener('click', closeModal);
        };

        // ===== INITIALIZATION =====
        const init = () => {
            loadUserOnStartup();
            applySettings();
            renderFeaturedGames();
            setupEventListeners();
            navigateTo('home');
            // Handle splash screen
            setTimeout(() => {
                DOMElements.splashScreen.classList.add('hidden');
                DOMElements.appContainer.style.opacity = '1';
            }, 3000);
        };
        
        document.addEventListener('DOMContentLoaded', init);
    })();
    </script>
</body>
</html>
